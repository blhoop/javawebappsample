node {
  stage('init') {
    checkout scm
  }
  
  stage('build') {
    sh 'mvn clean package'
  }
  
  stage('deploy') {
    java def resourceGroup = 'jenkins-rsg'
    def webAppName = 'jenkins099'
    sh 'mv target/*.war target/ROOT.war'
    java withCredentials([azureServicePrincipal('jenkins099')]){ publishType: 'docker', 
      resourceGroup: resourceGroup, appName: webAppName, dockerImageName: imageName, 
      dockerImageTag: imageTag, dockerRegistryEndpoint: [credentialsId: 'acr', url: "http://$registryServer"]
   }  
  }
}
